# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem      1.0
PortGroup       github 1.0

github.setup    kmgrant macterm 4a8d554abcac45512e60afb632f0307eed8bb6a0
version         4.0.9-20130522
categories      aqua shells
platforms       {darwin > 9}
supported_archs i386 ppc
maintainers     {@barracuda156 macos-powerpc.org:barracuda} openmaintainer
license         GPL-2+
description     Terminal emulator for macOS
long_description \
                {*}${description} with 24-bit color, bitmap and vector graphics.
homepage        https://www.macterm.net

github.tarball_from archive

set growl_v         1.3

# TODO: switch to our Growl, upon updating it.
# See discussion: https://github.com/kmgrant/macterm/issues/12

master_sites-append https://github.com/growl/growl/archive/refs/tags/:growl
distfiles-append    Growl_SDK_${growl_v}.tar.gz:growl

checksums           ${distname}${extract.suffix} \
                    rmd160  739f45dd9cd516587281f7edca2ac25e8fed0fa9 \
                    sha256  fb36d55cacfc307787cb2a553434cb2ef07ff7d44b85f9c7a9635d620d7b9fc6 \
                    size    2394734 \
                    Growl_SDK_${growl_v}.tar.gz \
                    rmd160  90636cf6574b42c23176d3b8ada6c66adbfe951f \
                    sha256  2c214116af68813aba4ffee9bdcf4b7610744537d48723c6ccd700a40ae7e57c \
                    size    17146606

extract.only        ${distname}${extract.suffix}

worksrcdir          ${worksrcpath}/Build

post-extract {
    set tar [findBinary tar ${portutil::autoconf::tar_command}]
    system -W ${workpath} "${tar} -zxf ${distpath}/Growl_SDK_${growl_v}.tar.gz"
    move ${workpath}/growl-Growl_SDK_${growl_v} ${worksrcpath}/GrowlSDK
}

patch.pre_args-replace  -p0 -p1
patchfiles      0001-Fix-VALID_ARCHS.patch \
                0002-Use-MacPorts-swig.patch \
                0003-Disable-building-html-help.patch

post-patch {
    reinplace "s|@PREFIX@|${prefix}|" ${worksrcpath}/Shared/CustomPaths.xcconfig
}

depends_build-append \
                port:swig3-python

use_configure   no
build.target
build.cmd-prepend \
                ARCHS=${configure.build_arch} \
                MACOSX_DEPLOYMENT_TARGET=${macosx_deployment_target}

destroot {
    copy ${worksrcpath}/MacTerm.app ${destroot}${applications_dir}/
}
