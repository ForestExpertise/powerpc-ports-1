# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               cmake 1.1
PortGroup               github 1.0
PortGroup               legacysupport 1.1

# strnlen
legacysupport.newest_darwin_requires_legacy 10

github.setup            rnpgp rnp 0.17.1 v
revision                0
categories              devel net
maintainers             {@barracuda156 macos-powerpc.org:barracuda} openmaintainer
license                 BSD
description             high performance C++ OpenPGP library
long_description        {*}${description} used by Mozilla Thunderbird.
homepage                https://www.rnpgp.org
checksums               rmd160  3d91a976c7430e4f2c2252cb0b37fbc4ecddf359 \
                        sha256  ec486bb2c25abb0ddbd95973fd135e3922ea68b4e6919c7c18d992078baaf50c \
                        size    3515288
github.tarball_from     archive

depends_build-append    port:gtest \
                        path:bin/pkg-config:pkgconfig

depends_lib-append      port:botan \
                        port:bzip2 \
                        port:gnupg2 \
                        port:json-c \
                        port:libsexpp \
                        port:zlib

# https://github.com/rnpgp/rnp/pull/2325
patchfiles              0001-librepgp-stream-fix-inttypes.patch \
                        0002-librekey-fix-inttypes.patch \
                        0003-lib-rnp.cpp-fix-inttypes.patch

# For tests.
compiler.cxx_standard   2014

# TODO: add a variant with OpenSSL backend.
configure.args-append   -DCRYPTO_BACKEND="botan" \
                        -DDOWNLOAD_GTEST=OFF \
                        -DENABLE_COVERAGE=OFF \
                        -DENABLE_DOC=OFF \
                        -DENABLE_FUZZERS=OFF \
                        -DENABLE_SANITIZERS=OFF \
                        -DSYSTEM_LIBSEXPP=ON

# FIXME! Tests fail on powerpc now: https://github.com/rnpgp/rnp/issues/2326
test.run                yes
