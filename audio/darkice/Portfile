# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                darkice
version             1.3
revision            1
categories          audio
platforms           darwin freebsd
maintainers         nomaintainer
license             GPL-3+
description         Live audio encoder and streamer
long_description    DarkIce is a live audio streamer. It records audio from \
                    an audio interface (e.g. sound card), encodes it and \
                    sends it to a streaming server (i.e. IceCast, ShoutCast...).

homepage            http://www.darkice.org
master_sites        sourceforge:project/darkice/darkice/${version}/ \
                    ${homepage}download/

checksums           rmd160  23ecd35ee210b751fd90bb1483b6dcd0ff9df341 \
                    sha256  2c0d0faaa627c0273b2ce8b38775a73ef97e34ef866862a398f660ad8f6e9de6 \
                    size    371411

depends_build       path:bin/pkg-config:pkgconfig

patchfiles          1e2eb18d349f205c70cb2836232825442359b6e3.patch \
                    patch-FaacEncoder.cpp.diff

configure.args      --without-aacplus \
                    --without-faac \
                    --without-jack \
                    --without-lame \
                    --without-opus \
                    --without-pulseaudio \
                    --without-samplerate \
                    --without-twolame \
                    --without-vorbis

# Some dependencies need C11.
# error: comma at end of enumerator list
compiler.c_standard     2011
# error: ISO C++17 does not allow dynamic exception specifications
compiler.cxx_standard   2011
configure.cxxflags-append \
                    -std=c++11

default_variants    +faac +lame

variant faac description {Add FAAC encoding} {
    depends_lib-append \
       port:faac
    configure.args-replace \
       --without-faac --with-faac
    configure.args-append \
       --with-faac-prefix=${prefix}
}

variant jack description {Add JACK Audio connectivity} {
    depends_lib-append \
       port:jack
    configure.args-replace \
       --without-jack --with-jack
    configure.args-append \
       --with-jack-prefix=${prefix}
}

variant lame description {Add LAME encoding} {
    depends_lib-append \
       port:lame
    configure.args-replace \
       --without-lame --with-lame
    configure.args-append \
       --with-lame-prefix=${prefix}
}

variant opus description {Add OPUS encoding} {
    depends_lib-append \
       port:libopus
    configure.args-replace \
       --without-opus --with-opus
    configure.args-append \
       --with-opus-prefix=${prefix}
}

variant samplerate description {Add Samplerate encoding} {
    depends_lib-append \
       port:libsamplerate
    configure.args-replace \
       --without-samplerate --with-samplerate
    configure.args-append \
       --with-samplerate-prefix=${prefix}
}

variant twolame description {Add TWOLAME encoding} {
    depends_lib-append \
       port:twolame
    configure.args-replace \
       --without-twolame --with-twolame
    configure.args-append \
       --with-twolame-prefix=${prefix}
}

variant vorbis description {Add OGG-VORBIS encoding} {
    depends_lib-append \
       port:libvorbis
    configure.args-replace \
       --without-vorbis --with-vorbis
    configure.args-append \
       --with-vorbis-prefix=${prefix}
}
