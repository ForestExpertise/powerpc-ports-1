From f3b0049aea0eff2c8e1124a3d3179b143894b920 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <barracuda@macos-powerpc.org>
Date: Fri, 18 Apr 2025 15:07:32 +0800
Subject: [PATCH 62/62] Down

---
 src/modules/Extensions/Downloader.cpp | 13 ++++++-------
 src/modules/Extensions/Downloader.hpp |  4 +++-
 2 files changed, 9 insertions(+), 8 deletions(-)

diff --git a/src/modules/Extensions/Downloader.cpp b/src/modules/Extensions/Downloader.cpp
index 1af5e9e1..0160b026 100644
--- a/src/modules/Extensions/Downloader.cpp
+++ b/src/modules/Extensions/Downloader.cpp
@@ -1057,9 +1057,8 @@ bool Downloader::modifyConvertAction(QAction *action, bool addRemoveButton)
         removeB->setIcon(QMPlay2Core.getIconFromTheme("list-remove"));
 
         // Store the button, action, and dialog in member variables for later access
-        this->removeB = removeB;
-        this->currentAction = action;
-        this->currentDialog = &dialog;
+        currentAction = action;
+        currentDialog = &dialog;
 
         // Connect the remove button to the slot
         connect(removeB, SIGNAL(clicked()), this, SLOT(handleRemoveButtonClicked()));
@@ -1085,12 +1084,12 @@ bool Downloader::modifyConvertAction(QAction *action, bool addRemoveButton)
     return false;
 }
 
-void Downloader::handleButtonClicked(removeB, action, &dialog);
+void Downloader::handleButtonClicked(QAbstractButton *button)
 {
-    if (button == removeB)
+    if (button == removeB && currentAction && currentDialog) // Ensure valid pointers
     {
-        action->deleteLater();
-        dialog->reject();
+        currentAction->deleteLater();
+        currentDialog->reject();
     }
 }
 
diff --git a/src/modules/Extensions/Downloader.hpp b/src/modules/Extensions/Downloader.hpp
index 8bd892ad..c14ce2ac 100644
--- a/src/modules/Extensions/Downloader.hpp
+++ b/src/modules/Extensions/Downloader.hpp
@@ -192,7 +192,9 @@ private:
     QToolButton *m_convertsPresetsB;
     QMenu *m_convertsMenu;
 
-    QPushButton *removeB;
+    QAction *currentAction;      // Pointer to the current action being modified
+    QDialog *currentDialog;      // Pointer to the current dialog being used
+    QPushButton *removeB; 
 };
 
 #define DownloaderName "QMPlay2 Downloader"
-- 
2.49.0

