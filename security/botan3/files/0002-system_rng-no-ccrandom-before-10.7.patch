From 3fa1d9910280b578004598018f611eac2ef6b4b5 Mon Sep 17 00:00:00 2001
From: Sergey Fedorov <barracuda@macos-powerpc.org>
Date: Wed, 28 May 2025 12:53:11 +0800
Subject: [PATCH 2/4] system_rng: no ccrandom before 10.7

---
 src/lib/rng/system_rng/system_rng.cpp | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git src/lib/rng/system_rng/system_rng.cpp src/lib/rng/system_rng/system_rng.cpp
index 5490bf594..6075bbcea 100644
--- src/lib/rng/system_rng/system_rng.cpp
+++ src/lib/rng/system_rng/system_rng.cpp
@@ -17,12 +17,16 @@
    #include <windows.h>
 #endif
 
+#if defined(BOTAN_TARGET_OS_IS_MACOS)
+   #include <AvailabilityMacros.h>
+#endif
+
 #if defined(BOTAN_TARGET_OS_HAS_RTLGENRANDOM)
    #include <botan/internal/dyn_load.h>
 #elif defined(BOTAN_TARGET_OS_HAS_CRYPTO_NG)
    #include <bcrypt.h>
    #include <windows.h>
-#elif defined(BOTAN_TARGET_OS_HAS_CCRANDOM)
+#elif defined(BOTAN_TARGET_OS_HAS_CCRANDOM) && (MAC_OS_X_VERSION_MIN_REQUIRED >= 1070)
    #include <CommonCrypto/CommonRandom.h>
 #elif defined(BOTAN_TARGET_OS_HAS_ARC4RANDOM)
    #include <stdlib.h>
@@ -147,7 +151,7 @@ class System_RNG_Impl final : public RandomNumberGenerator {
       BCRYPT_ALG_HANDLE m_prov;
 };
 
-#elif defined(BOTAN_TARGET_OS_HAS_CCRANDOM)
+#elif defined(BOTAN_TARGET_OS_HAS_CCRANDOM) && (MAC_OS_X_VERSION_MIN_REQUIRED >= 1070)
 
 class System_RNG_Impl final : public RandomNumberGenerator {
    public:
-- 
2.48.0

